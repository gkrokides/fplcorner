{% extends 'fplcornerapp/base.html' %}

{% block head %}
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>	

    <script type="text/javascript">
        function getOptionSelection(sel) {
          return sel.options[sel.selectedIndex].text;
        }
    </script>

    <script type="text/javascript">
        function getChartTitle() {
            // var m1 = document.getElementById("m_one");
            // var m1selection = getOptionSelection(m1);
            // var m2 = document.getElementById("m_two");
            // var m2selection = getOptionSelection(m2);
            // var chartTitle = m1selection + " vs. " + m2selection;
            var chartTitle = "{{ graph_title }}"
            return chartTitle;
        }
    </script> 

     <script type="text/javascript">
        // function topnSelected() {
        //     var element = document.getElementById('topn');
        //     if ({{ generate_graph }} > 0) {
        //         element.value="{{ topn_selected }}";
        //     } else {
        //         element.value="5";
        //     }
        // }
        
     </script> 


{% endblock %}

{% block content %}
    <form method="POST" class="">{% csrf_token %}
    <div class="card card-body">
        <div class="row justify-content-center">
            <div class="col-10">
                <div class="d-flex justify-content-center mb-3">
                    <div class="p-2">
                        <select class="selectpicker border border-success" data-live-search="true" data-width="auto" name="topn" id="topn">
                          <option value="5">Top 5</option>
                          <option value="10">Top 10</option>
                          <option value="15">Top 15</option>
                          <option value="20">Top 20</option>
                        </select>
                    </div>
                    <div class="p-2">
                        <select class="selectpicker border border-success" data-live-search="true" data-width="auto" name="pos" id="pos" onChange="">
                          <option value="GKP">Goalkeepers</option>
                          <option value="DEF">Defenders</option>
                          <option value="MID">Midfielders</option>
                          <option value="FWD">Forwards</option>
                        </select>
                    </div>
                </div>    
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-10">
                <div class="d-flex justify-content-center mb-3">
                    <div class="p-2">
                        <select class="selectpicker border border-success" data-live-search="true" data-width="auto" name="metric1" id="m_one" onChange="getChartTitle();">
                          {# <option value="{{metric1}}" selected>{{ default1 }}</option> #}
                          {% for key, value in available_metrics.items %}
                            {% if key == metric1 %}
                                <option value="{{ key }}" selected>{{ value }}</option>
                            {% else %}
                                <option value="{{ key }}">{{ value }}</option>
                            {% endif %}    
                            
                          {% endfor %}{% csrf_token %}
                        </select>
                    </div>
                    <div class="p-3">
                        vs.
                    </div>
                    <div class="p-2">
                        <select class="selectpicker border border-success" data-live-search="true" data-width="auto" name="metric2" id="m_two" onChange="getChartTitle();">
                          {# <option value="{{ metric2 }}" selected>{{ default2 }}</option> #}
                          {% for key, value in available_metrics.items %}
                            {% if key == metric2 %}
                                <option value="{{ key }}" selected>{{ value }}</option>
                            {% else %}
                                <option value="{{ key }}">{{ value }} </option>
                            {% endif %}    
                          {% endfor %}{% csrf_token %}
                        </select>
                    </div>
                </div>    
            </div>
        </div>
        <div class="row justify-content-center">
            <button type="submit" class="btn btn-warning">Discover</button>
        </div>
    </div>
        
    </form>
    

    <div class="row justify-content-center">
        <div class="col-10">
            <canvas id="myChart"></canvas>
        </div>
        
    </div>
	

	<script type="text/javascript">
        
        if ({{ generate_graph }} > 0){
            var ctx = document.getElementById("myChart").getContext('2d');
            var chartTitle = getChartTitle();
            var labels = {{ graph_labels_json|safe }};
            var data = {{ graph_data_json|safe }};
            
            var options = {responsive: true, // Instruct chart js to respond nicely.
                maintainAspectRatio: false, // Add to prevent default behaviour of full-width/height 
                tooltips: {
                    callbacks: {
                    label: function(tooltipItem, data) {
                       var label = data.labels[tooltipItem.index];
                       return label + ': (' + tooltipItem.xLabel + ', ' + tooltipItem.yLabel + ')';
                    }
                 }
                },
                scales: {
                    yAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: "{{ default2 }}"
                      }
                    }],
                    xAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: "{{ default1 }}"
                      }
                    }]
                } 
            };

            var myChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    labels: labels,
                    datasets: [{
                            label: chartTitle, // Name the series
                            data: data, // Specify the data values array
                      borderColor: '#2196f3', // Add custom color border            
                      backgroundColor: '#2196f3', // Add custom color background (Points and Fill)
                        }]
                },
                options: options
        }); 
        }
            
        
        
	</script>

    <script type="text/javascript">
        document.getElementById('topn').value="{{ topn_selected|safe }}";
        document.getElementById('pos').value="{{ position|safe }}";
        document.getElementById('m_one').value="{{ metric1|safe }}";
        document.getElementById('m_two').value="{{ metric2|safe }}";
     </script>

{% endblock %}